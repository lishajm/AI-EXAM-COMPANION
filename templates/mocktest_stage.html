<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Stage {{ stage }} - Mock Test</title>

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
}

body{
  font-family:'Outfit',sans-serif;
  background:#050505;
  color:#fff;
  height:100vh;
  overflow:hidden;
  position:relative;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding-top:60px;
}

/* üíú Animated Purple Grid Background */
body::before{
  content:"";
  position:absolute;
  width:150%; /* optimized for performance */
  height:150%;
  background-image:
    linear-gradient(rgba(170,0,255,0.06) 1px, transparent 1px),
    linear-gradient(90deg, rgba(170,0,255,0.06) 1px, transparent 1px);
  background-size:60px 60px;
  animation:moveGrid 30s linear infinite;
  z-index:-4;
  will-change: transform;
}

@keyframes moveGrid{
  from{ transform:translate(0,0); }
  to{ transform:translate(-60px,-60px); }
}

/* üíú Soft Glow Background Orbs */
.glow{
  position:absolute;
  width:400px;
  height:400px;
  background:radial-gradient(circle, rgba(180,0,255,0.25), transparent 70%);
  filter:blur(90px);
  z-index:-3;
  will-change: transform, opacity;
}

.glow1{ top:-150px; left:-150px; }
.glow2{ bottom:-150px; right:-150px; }

/* ‚¨Ö Back Arrow */
.back-arrow{
  position:fixed;
  top:20px;
  left:20px;
  font-size:1.8rem;
  color:#d000ff;
  cursor:pointer;
  z-index:10;
  transition:0.3s ease;
}

.back-arrow:hover{
  transform:scale(1.2);
  color:#fff;
}

/* ü§ñ Floating AI Robot */
.ai-robot{
  position:fixed;
  top:20px;
  right:20px;
  width:65px;
  height:65px;
  z-index:5;
  pointer-events:none;
  animation:floatRobot 3s ease-in-out infinite;
}

.ai-robot img{
  width:100%;
  height:100%;
  object-fit:contain;
  border-radius:12px;
  box-shadow:0 0 20px rgba(180,0,255,0.6);
}

@keyframes floatRobot{
  0%,100%{transform:translateY(0);}
  50%{transform:translateY(-8px);}
}

/* üíé Glass Container */
.chat-container{
  max-width:900px;
  width:95%;
  height:90vh;
  background:rgba(0,0,0,0.65);
  border-radius:28px;
  border:1px solid rgba(170,0,255,0.4);
  backdrop-filter:blur(15px); /* optimized */
  box-shadow:
    0 0 50px rgba(170,0,255,0.4),
    inset 0 0 40px rgba(255,255,255,0.05);
  padding:30px;
  display:flex;
  flex-direction:column;
  gap:20px;
  overflow:hidden;
  position:relative;
}

/* Light Sweep Animation */
.chat-container::before{
  content:"";
  position:absolute;
  top:0;
  left:-100%;
  width:40%; /* optimized */
  height:100%;
  background:linear-gradient(120deg, transparent, rgba(255,255,255,0.08), transparent);
  animation:shine 6s infinite;
  pointer-events:none;
}

@keyframes shine{
  0%{ left:-100%; }
  100%{ left:150%; }
}

/* HEADER */
.header{
  text-align:center;
  padding-bottom:15px;
  border-bottom:1px solid rgba(255,255,255,0.2);
  font-weight:700;
  font-size:1.5rem;
  letter-spacing:1px;
  background:linear-gradient(90deg,#8a00ff,#d000ff,#ffffff);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

/* CHAT BODY */
.chat-body{
  flex:1;
  overflow-y:auto;
  padding:20px 10px;
  display:flex;
  flex-direction:column;
  gap:20px;
}

/* QUESTION CARD */
.question-card{
  background:rgba(255,255,255,0.05);
  padding:20px;
  border-radius:16px;
  border:1px solid rgba(170,0,255,0.3);
  box-shadow:0 0 25px rgba(170,0,255,0.3);
}

/* QUESTION TEXT */
.question-card .question{
  background:#fff;
  color:#111;
  padding:14px 18px;
  border-radius:10px;
  font-size:1.1rem;
  font-weight:500;
  margin-bottom:18px;
}

/* OPTIONS */
.option{
  background:rgba(0,0,0,0.8);
  padding:14px 18px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.3);
  margin-bottom:12px;
  cursor:pointer;
  transition:0.3s;
}

.option:hover{
  box-shadow:0 0 15px rgba(180,0,255,0.5);
  border-color:#a100ff;
}

/* CORRECT */
.correct{
  border-color:#22c55e;
  background:#07150c;
  box-shadow:0 0 14px rgba(34,197,94,0.6);
}

/* WRONG */
.wrong{
  border-color:#ef4444;
  background:#1a0606;
  box-shadow:0 0 14px rgba(239,68,68,0.6);
}

/* EXPLANATION */
.explanation{
  margin-top:12px;
  color:#c77dff;
  font-size:0.9rem;
  font-style:italic;
}

@media(max-width:600px){
  .chat-container{
    height:95vh;
    padding:20px;
  }
  .header{
    font-size:1.3rem;
  }
  .question-card .question{
    font-size:1rem;
  }
  .back-arrow{
    font-size:1.5rem;
  }
}
</style>
</head>

<body>

<!-- Back Arrow -->
<div class="back-arrow" onclick="history.back()">‚Üê</div>

<!-- Glowing Orbs -->
<div class="glow glow1"></div>
<div class="glow glow2"></div>

<!-- ü§ñ AI ROBOT -->
<div class="ai-robot">
  <img src="/static/images/robo.jpg" alt="AI Robot">
</div>

<div class="chat-container">

  <div class="header">
    Stage {{ stage }} - Mock Test
  </div>

  <div class="chat-body" id="questionBox"></div>

</div>

<script>
const questions = {{ questions | safe }};
let current = 0;
let score = 0;
let answered = {};

function loadQuestion() {
  const q = questions[current];

  let html = `<div class="question-card">
                <div class="question">
                  Q${current + 1}. ${q.question}
                </div>`;

  q.options.forEach(opt => {
    html += `<div class="option" onclick="handleClick(this)">${opt}</div>`;
  });

  html += `<div id="exp" class="explanation"></div></div>`;
  document.getElementById("questionBox").innerHTML = html;
}

function handleClick(el) {
  if (answered[current]) return;
  answered[current] = true;

  const q = questions[current];
  const selected = el.innerText.trim();

  document.querySelectorAll(".option").forEach(opt => {
    if (opt.innerText.trim() === q.answer) opt.classList.add("correct");
    if (opt === el && selected !== q.answer) opt.classList.add("wrong");
  });

  if (selected === q.answer) score++;
  document.getElementById("exp").innerText = q.explanation;

  setTimeout(() => {
    if (current < questions.length - 1) {
      current++;
      loadQuestion();
    } else {
      window.location.href = `/mocktest/{{ stage }}/result?score=${score}`;
    }
  }, 3000);
}

loadQuestion();
</script>

</body>
</html>
